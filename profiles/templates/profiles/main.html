{% extends 'profiles/base.html' %}

{% block content %}
    <h1>DB Sharding</h1>
    <div>
        <form id='main-form' action='{% url main-ajax %}' method='post'>
            {% csrf_token %}
            <input id='main-form-button' type='submit' value='Process'>
        </form>
    </div>
    
    {% for shard in shards %}
        <h2>logical-{{ shard }}</h2>
        <ul id='{{ shard }}'>
        </ul>
    {% endfor %}

{% endblock content %}


{% block extrajs %}
    <script>
        var business_ids = {{ business_ids|safe }};
        var shards = {{ shards|safe }};

        function random_item(input) {
            var idx = Math.floor(Math.random() * input.length);
            return input[idx];
        }
    </script>

    <script>
        var $form = $('#main-form');
        var $business_input = $('#id-business');

        $('#main-form-button').click(function(e){
            e.preventDefault();
            var business_id = random_item(business_ids);
            console.log('clicked' + business_id);
            $.ajax({
                url: $form.attr('action'),
                type: $form.attr('method'),
                data: $form.serialize() + "&business=" + business_id
            });
        });

    </script>
{% endblock %}
